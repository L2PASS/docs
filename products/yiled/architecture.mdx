---
title: "Architecture"
icon: "layer-group"
iconType: light
---

## System Overview

Overnight Yield is a non-custodial interoperability component within the L2Pass protocol designed to provide stablecoin yield without lockup periods or withdrawal cooldowns. The protocol automates the deployment of USDT into established yield-generating venues on the TRON network, utilizing the Peg Stability Module (PSM) and JustLend for liquidity routing.

The system abstracts the complexity of manual cross-token swaps and lending interactions, enabling users to maintain a liquid position while accruing rewards based on a streaming weight mechanism.

<img
  src="/images/architecture.png"
  alt="L2Pass Yield Architecture Diagram"
  className="rounded-lg"
/>

---

## System Layers

The L2Pass Yield architecture is organized into five functional layers to separate execution, liquidity movement, and yield generation.

### 1. Finality Layer
The underlying blockchain infrastructure providing consensus and settlement for all protocol interactions.
**TRON:** The primary execution environment for the current vault implementation.
**Ethereum:** Planned for future expansion to support multi-chain yield strategies.

### 2. Transfer Layer
Manages the conversion and movement of assets between stablecoin variants.
**Native USDT (TRC20):** The primary entry and exit asset for users.
**Peg Stability Module (PSM):** Facilitates swaps between **USDT** and **USDD**.
**GEM_JOIN:** The approval target required for PSM interactions when converting USDT to USDD.

### 3. User Layer
Interfaces for user interaction and position monitoring.
* **Smart Liquid Vault Interface:** Frontend for initiating deposit and withdrawal actions.
**Position Accounting:** Each user position is tracked on-chain via the `amountActive` mapping.
**Transparency:** Users can view pending rewards and active balances directly from the contract state.

### 4. Smart Vault Layer
The core logic resides in the `WeeklyStreamingStaking` contract, which handles asset management and reward accounting.
**Vault Accounting:** Tracks balances in **jUSDD** units and manages `userWeightSeconds` for reward distribution.
**Streaming Reward Pipeline:** Manages the distribution of rewards over weekly epochs (604,800 seconds).
]**Risk Parameters:** Admin-controlled settings including pause functionality and fee adjustments.

### 5. Yield Layer
The destination for capital deployment to generate returns.
**JustLend:** Primary venue where **USDD** is supplied to mint interest-bearing **jUSDD**.
**Incentive Engines:** Weekly distributions from the protocol or external partners funded via the `fundRewards` function.

---

## Core Mechanics

### Streaming Weight Accounting
The protocol uses a time-weighted mechanism to ensure equitable reward distribution:
**Weight Calculation:** User rewards are determined by `userWeightSeconds`, representing the product of the active balance and the duration of the stake within a specific week.
**Total Weight:** A global `totalWeightSeconds` tracks the sum of all participant weights to calculate proportional shares.
**Weight Accrual:** Weights are updated ("accrued") during every interaction (deposit, withdrawal, or claim) to ensure accurate accounting.

### Liquidity Routing Flow
1. **Deposit:** USDT is transferred to the contract and swapped for USDD via the PSM.
USDD is then supplied to JustLend to mint jUSDD.
2. **Standard Withdrawal:** jUSDD is redeemed for USDD. USDD is then converted back to USDT via the PSM for delivery to the user.
3. **Direct Withdrawal:** Users may redeem jUSDD for USDD and withdraw the raw USDD tokens directly to mitigate PSM liquidity constraints.

---

## Economics & Fees

### Fee Configuration
**Performance Fee:** A protocol-level fee (curently 0%) is applied to rewards claimed via the Merkle distributor.
**Accrued Fees:** Fees are accumulated in USDT and can be withdrawn by authorized protocol managers.

---

## External Dependencies
The protocol relies on the functional availability of the following external systems:

**TRON Network:** For transaction finality.

**USDD PSM:** For converting USDT into the yield-generating USDD token.

**JustLend:** For the generation of lending interest via jUSDD.

<CardGroup cols={2}> <Card title="User Flow" icon="diagram-project" href="/products/yield/user-flow"> Detailed lifecycle of deposit and withdrawal actions. </Card> <Card title="Risks" icon="circle-info" href="/products/yield/risks"> Technical and economic risks associated with the architecture. </Card> </CardGroup>